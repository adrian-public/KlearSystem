services:
  redis:
    image: redis:7-alpine
    container_name: klear-redis
    ports:
      - "6379:6379"

  trade-controller:
    image: eclipse-temurin:17-jre
    container_name: klear-trade-controller
    working_dir: /app
    user: "${UID:-1000}:${GID:-1000}"
    volumes:
      - ./trade-controller/target/trade-controller-0.0.1-SNAPSHOT.jar:/app/app.jar
    command:
      - java
      - -agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=*:5005
      - -jar
      - /app/app.jar
    environment:
      - REDIS_IP=redis
      - REDIS_PORT=6379
    depends_on:
      - redis
    ports:
      - "8080:8080"
      - "5005:5005"

  trade-service:
    image: eclipse-temurin:17-jre
    container_name: klear-trade-service
    working_dir: /app
    user: "${UID:-1000}:${GID:-1000}"
    volumes:
      - ./trade-service/target/trade-service-1.0-SNAPSHOT-exec.jar:/app/app.jar
    command:
      - java
      - -agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=*:5006
      - -jar
      - /app/app.jar
    environment:
      - REDIS_IP=redis
      - REDIS_PORT=6379
    depends_on:
      - redis
    ports:
      - "5006:5006"

  account-service:
    image: eclipse-temurin:17-jre
    container_name: klear-account-service
    working_dir: /app
    user: "${UID:-1000}:${GID:-1000}"
    volumes:
      - ./services/account-service/target/account-service-1.0-SNAPSHOT.jar:/app/app.jar
    command:
      - java
      - -agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=*:5007
      - -jar
      - /app/app.jar
    environment:
      - REDIS_IP=redis
      - REDIS_PORT=6379
    depends_on:
      - redis
    ports:
      - "5007:5007"

  execution-service:
    image: eclipse-temurin:17-jre
    container_name: klear-execution-service
    working_dir: /app
    user: "${UID:-1000}:${GID:-1000}"
    volumes:
      - ./services/execution-service/target/execution-service-1.0-SNAPSHOT.jar:/app/app.jar
    command:
      - java
      - -agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=*:5008
      - -jar
      - /app/app.jar
    environment:
      - REDIS_IP=redis
      - REDIS_PORT=6379
    depends_on:
      - redis
    ports:
      - "5008:5008"

  clearing-service:
    image: eclipse-temurin:17-jre
    container_name: klear-clearing-service
    working_dir: /app
    user: "${UID:-1000}:${GID:-1000}"
    volumes:
      - ./services/clearing-service/target/clearing-service-1.0-SNAPSHOT.jar:/app/app.jar
    command:
      - java
      - -agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=*:5009
      - -jar
      - /app/app.jar
    environment:
      - REDIS_IP=redis
      - REDIS_PORT=6379
    depends_on:
      - redis
    ports:
      - "5009:5009"

  settlement-service:
    image: eclipse-temurin:17-jre
    container_name: klear-settlement-service
    working_dir: /app
    user: "${UID:-1000}:${GID:-1000}"
    volumes:
      - ./services/settlement-service/target/settlement-service-1.0-SNAPSHOT.jar:/app/app.jar
    command:
      - java
      - -agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=*:5010
      - -jar
      - /app/app.jar
    environment:
      - REDIS_IP=redis
      - REDIS_PORT=6379
    depends_on:
      - redis
    ports:
      - "5010:5010"
